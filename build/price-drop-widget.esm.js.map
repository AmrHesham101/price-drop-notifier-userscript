{
  "version": 3,
  "sources": ["../widget/src/index.ts"],
  "sourcesContent": ["const CSS_CLASS = 'pdn-widget-root';\r\n\r\n// Server URL - change for production deployment\r\nconst SERVER_URL = 'http://localhost:3000';\r\n\r\ntype Product = { name: string; price: string; url: string };\r\n\r\n// In-memory email storage\r\nlet savedEmailInMemory = '';\r\n\r\nfunction createRoot() {\r\n    const root = document.createElement('div');\r\n    root.className = CSS_CLASS;\r\n    root.innerHTML = `\r\n    <form class=\"pdn-form\" novalidate>\r\n      <label class=\"pdn-label\">Email me if this product gets cheaper</label>\r\n      <div class=\"pdn-row\">\r\n        <input class=\"pdn-input\" type=\"email\" name=\"email\" placeholder=\"you@example.com\" required />\r\n        <button class=\"pdn-btn\" type=\"submit\">Notify me</button>\r\n      </div>\r\n      <div class=\"pdn-status\" aria-live=\"polite\"></div>\r\n    </form>\r\n  `;\r\n    return root;\r\n}\r\n\r\nfunction applyStyles() {\r\n    if (document.getElementById('pdn-widget-styles')) return;\r\n    const link = document.createElement('link');\r\n    link.rel = 'stylesheet';\r\n    link.href = `${SERVER_URL}/build/price-drop-widget.min.css`;\r\n    link.id = 'pdn-widget-styles';\r\n    document.head.appendChild(link);\r\n}\r\n\r\nfunction parseProductFromPage(): Product {\r\n    const url = location.href;\r\n\r\n    // Title extraction - Amazon and eBay specific\r\n    const amazonTitle = document.querySelector('#productTitle');\r\n    const ebayTitle = document.querySelector('.x-item-title__mainTitle, #itemTitle, .it-ttl');\r\n    const genericTitle = document.querySelector('h1, h2');\r\n    const name = (amazonTitle?.textContent || ebayTitle?.textContent || genericTitle?.textContent || document.title).trim();\r\n\r\n    // Price selectors - Amazon and eBay specific\r\n    const priceSelectors = [\r\n        '#corePriceDisplay_desktop_feature_div .a-price .a-offscreen',\r\n        '#corePrice_desktop .a-price .a-offscreen',\r\n        '.priceToPay .a-offscreen',\r\n        '#priceblock_ourprice',\r\n        '#priceblock_dealprice',\r\n        '.a-price .a-offscreen',\r\n        '.x-price-primary .ux-textspans',\r\n        '.x-price-primary',\r\n        '#prcIsum',\r\n        '.display-price',\r\n        '.notranslate',\r\n        '.price'\r\n    ];\r\n\r\n    let price = '';\r\n    for (const sel of priceSelectors) {\r\n        const el = document.querySelector(sel);\r\n        if (el && (el.textContent || '').trim()) {\r\n            price = (el.textContent || '').trim();\r\n            break;\r\n        }\r\n    }\r\n    if (!price) price = 'unknown';\r\n    return { name, price, url };\r\n}\r\n\r\nasync function postSubscribe(email: string, product: Product) {\r\n    const endpoint = `${SERVER_URL}/subscribe-price-drop`;\r\n    const payload = { email, product };\r\n    try {\r\n        const res = await fetch(endpoint, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(payload),\r\n        });\r\n        return res.json();\r\n    } catch (err) {\r\n        throw err;\r\n    }\r\n}\r\n\r\nexport function init(container: HTMLElement | string, options?: { product?: Product }) {\r\n    const mount = typeof container === 'string' ? document.querySelector(container) : container;\r\n    if (!mount) return;\r\n    applyStyles();\r\n    const root = createRoot();\r\n    mount.appendChild(root);\r\n\r\n    const form = root.querySelector('form') as HTMLFormElement;\r\n    const input = form.querySelector('input[name=email') as HTMLInputElement;\r\n    const status = root.querySelector('.pdn-status') as HTMLElement;\r\n\r\n    const product = options?.product ?? parseProductFromPage();\r\n\r\n    // Restore saved email from memory\r\n    if (savedEmailInMemory) {\r\n        input.value = savedEmailInMemory;\r\n    }\r\n\r\n    // Save email to memory on input\r\n    input.addEventListener('input', () => {\r\n        const email = input.value.trim();\r\n        if (email && email.includes('@')) {\r\n            savedEmailInMemory = email;\r\n        }\r\n    });\r\n\r\n    form.addEventListener('submit', async (e) => {\r\n        e.preventDefault();\r\n        const email = input.value.trim();\r\n        if (!email) {\r\n            status.textContent = 'Please enter an email.';\r\n            root.classList.add('pdn-error');\r\n            setTimeout(() => root.classList.remove('pdn-error'), 900);\r\n            return;\r\n        }\r\n        status.textContent = 'Submitting...';\r\n        root.classList.add('pdn-submitting');\r\n        try {\r\n            const json = await postSubscribe(email, product);\r\n            if (json && json.ok) {\r\n                status.textContent = '\u2713 Subscribed! We\\'ll email you if price drops.';\r\n                root.classList.add('pdn-success');\r\n\r\n                // Keep success message, clear input after delay\r\n                setTimeout(() => {\r\n                    input.value = '';\r\n                    status.textContent = '';\r\n                    root.classList.remove('pdn-success');\r\n                }, 3000);\r\n            } else if (json && json.error) {\r\n                if (json.error === 'already_subscribed') {\r\n                    status.textContent = 'Already subscribed to this product!';\r\n                } else {\r\n                    status.textContent = 'Error: ' + json.error;\r\n                }\r\n                root.classList.add('pdn-error');\r\n                setTimeout(() => {\r\n                    root.classList.remove('pdn-error');\r\n                    status.textContent = '';\r\n                }, 3000);\r\n            } else {\r\n                status.textContent = 'Unexpected response';\r\n                root.classList.add('pdn-error');\r\n                setTimeout(() => {\r\n                    root.classList.remove('pdn-error');\r\n                    status.textContent = '';\r\n                }, 3000);\r\n            }\r\n        } catch (err) {\r\n            status.textContent = 'Network error';\r\n            root.classList.add('pdn-error');\r\n            setTimeout(() => {\r\n                root.classList.remove('pdn-error');\r\n                status.textContent = '';\r\n            }, 3000);\r\n        } finally {\r\n            root.classList.remove('pdn-submitting');\r\n        }\r\n    });\r\n}\r\n\r\n// Expose to global for IIFE build\r\nif (typeof window !== 'undefined') {\r\n    (window as any).PriceDropWidget = { init };\r\n}\r\n"],
  "mappings": "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",
  "names": ["CSS_CLASS", "SERVER_URL", "savedEmailInMemory", "createRoot", "root", "applyStyles", "link", "parseProductFromPage", "url", "amazonTitle", "ebayTitle", "genericTitle", "name", "priceSelectors", "price", "sel", "el", "postSubscribe", "email", "product", "endpoint", "payload", "err", "init", "container", "options", "mount", "form", "input", "status", "e", "json"]
}
