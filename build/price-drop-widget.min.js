"use strict";var PriceDropWidget=(()=>{var y=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var L=(t,r)=>{for(var o in r)y(t,o,{get:r[o],enumerable:!0})},k=(t,r,o,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of S(r))!T.call(t,i)&&i!==o&&y(t,i,{get:()=>r[i],enumerable:!(e=E(r,i))||e.enumerable});return t};var P=t=>k(y({},"__esModule",{value:!0}),t);var F={};L(F,{init:()=>v,initFloating:()=>C});var M="pdn-widget-root",g="http://localhost:3000",f="";function q(){let t=document.createElement("div");return t.className=M,t.innerHTML=`
    <form class="pdn-form" novalidate>
      <label class="pdn-label">Email me if this product gets cheaper</label>
      <div class="pdn-row">
        <input class="pdn-input" type="email" name="email" placeholder="you@example.com" required />
        <button class="pdn-btn" type="submit">Notify me</button>
      </div>
      <div class="pdn-status" aria-live="polite"></div>
    </form>
  `,t}function H(){if(document.getElementById("pdn-widget-styles"))return;let t=document.createElement("link");t.rel="stylesheet",t.href=`${g}/build/price-drop-widget.min.css`,t.id="pdn-widget-styles",document.head.appendChild(t)}function x(){let t=location.href,r=document.querySelector("#productTitle"),o=document.querySelector(".x-item-title__mainTitle, #itemTitle, .it-ttl"),e=document.querySelector("h1, h2"),i=(r?.textContent||o?.textContent||e?.textContent||document.title).trim(),a=["#corePriceDisplay_desktop_feature_div .a-price .a-offscreen","#corePrice_desktop .a-price .a-offscreen",".priceToPay .a-offscreen","#priceblock_ourprice","#priceblock_dealprice",".a-price .a-offscreen",".x-price-primary .ux-textspans",".x-price-primary","#prcIsum",".display-price",".notranslate",".price"],n="";for(let c of a){let d=document.querySelector(c);if(d&&(d.textContent||"").trim()){n=(d.textContent||"").trim();break}}return n||(n="unknown"),{name:i,price:n,url:t}}async function h(t,r){let o=`${g}/subscribe-price-drop`,e={email:t,product:r};try{return(await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}catch(i){throw i}}function v(t,r){let o=typeof t=="string"?document.querySelector(t):t;if(!o)return;H();let e=q();o.appendChild(e);let i=e.querySelector("form"),a=i.querySelector("input[name=email"),n=e.querySelector(".pdn-status"),c=r?.product??x();f&&(a.value=f),a.addEventListener("input",()=>{let d=a.value.trim();d&&d.includes("@")&&(f=d)}),i.addEventListener("submit",async d=>{d.preventDefault();let u=a.value.trim();if(!u){n.textContent="Please enter an email.",e.classList.add("pdn-error"),setTimeout(()=>e.classList.remove("pdn-error"),900);return}n.textContent="Submitting...",e.classList.add("pdn-submitting");try{let s=await h(u,c);s&&s.ok?(n.textContent="\u2713 Subscribed! We'll email you if price drops.",e.classList.add("pdn-success"),setTimeout(()=>{a.value="",n.textContent="",e.classList.remove("pdn-success")},3e3)):s&&s.error?(s.error==="already_subscribed"?n.textContent="Already subscribed to this product!":n.textContent="Error: "+s.error,e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),n.textContent=""},3e3)):(n.textContent="Unexpected response",e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),n.textContent=""},3e3))}catch{n.textContent="Network error",e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),n.textContent=""},3e3)}finally{e.classList.remove("pdn-submitting")}})}function C(t){let r=t?.product??x(),o=document.createElement("button");o.id="pdn-floating-button",o.innerHTML=`
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
      </svg>
    `,Object.assign(o.style,{position:"fixed",bottom:"24px",right:"24px",width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"#0E6F78",color:"white",border:"none",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:"999999",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"}),o.onmouseenter=()=>{o.style.transform="scale(1.1)",o.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.2)"},o.onmouseleave=()=>{o.style.transform="scale(1)",o.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"};let e=document.createElement("div");e.id="pdn-floating-widget",Object.assign(e.style,{position:"fixed",bottom:"92px",right:"24px",width:"380px",maxWidth:"calc(100vw - 48px)",backgroundColor:"#ffffff",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)",zIndex:"999998",display:"none",flexDirection:"column",overflow:"hidden",transition:"all 0.3s ease",opacity:"0",transform:"translateY(20px)"});let i=document.createElement("div");Object.assign(i.style,{padding:"16px",backgroundColor:"#0E6F78",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"});let a=document.createElement("div");a.textContent="\u{1F4B0} Price Drop Alert",a.style.fontWeight="600",a.style.fontSize="16px";let n=document.createElement("button");n.innerHTML="\xD7",Object.assign(n.style,{background:"none",border:"none",color:"white",fontSize:"28px",cursor:"pointer",lineHeight:"1",padding:"0",width:"24px",height:"24px"}),i.appendChild(a),i.appendChild(n);let c=document.createElement("div");Object.assign(c.style,{padding:"16px",fontFamily:"Arial, Helvetica, sans-serif"}),c.innerHTML=`
      <form id="pdn-floating-form" style="display: flex; flex-direction: column; gap: 12px;">
        <div style="font-size: 13px; color: #6B7280; margin-bottom: 4px;">
          <div style="margin-bottom: 8px;"><strong>Product:</strong> ${r.name.substring(0,80)}${r.name.length>80?"...":""}</div>
          <div style="margin-bottom: 8px;"><strong>Current Price:</strong> ${r.price}</div>
        </div>
        <label style="font-size: 14px; color: #111827; font-weight: 500;">Email me if price drops:</label>
        <div style="display: flex; gap: 8px;">
          <input 
            type="email" 
            id="pdn-email-floating" 
            placeholder="you@example.com" 
            required
            style="flex: 1; padding: 10px; border: 1px solid #D8DEE3; border-radius: 6px; font-size: 14px;"
          />
          <button 
            type="submit" 
            id="pdn-submit-floating"
            style="background: #0E6F78; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 14px; white-space: nowrap;"
          >Notify me</button>
        </div>
        <div id="pdn-status-floating" style="font-size: 13px; color: #6B7280; min-height: 18px;"></div>
      </form>
    `,e.appendChild(i),e.appendChild(c),document.body.appendChild(o),document.body.appendChild(e);let d=c.querySelector("#pdn-floating-form"),u=c.querySelector("#pdn-email-floating"),s=c.querySelector("#pdn-submit-floating"),l=c.querySelector("#pdn-status-floating");d.addEventListener("submit",async w=>{w.preventDefault();let b=u.value.trim();if(!b){l.textContent="Please enter an email.",l.style.color="#EF4444";return}l.textContent="Submitting...",l.style.color="#6B7280",s.disabled=!0,s.style.opacity="0.6";try{let p=await h(b,r);p&&p.ok?(l.textContent="\u2713 Subscribed! We'll email you if price drops.",l.style.color="#10B981",u.value="",setTimeout(()=>{l.textContent="",s.disabled=!1,s.style.opacity="1"},3e3)):p&&p.error?(p.error==="already_subscribed"?l.textContent="Already subscribed to this product!":l.textContent="Error: "+p.error,l.style.color="#EF4444",s.disabled=!1,s.style.opacity="1"):(l.textContent="Unexpected response",l.style.color="#EF4444",s.disabled=!1,s.style.opacity="1")}catch(p){l.textContent="Network error. Is the server running?",l.style.color="#EF4444",s.disabled=!1,s.style.opacity="1",console.error("Price Drop Notifier error:",p)}});let m=!1;o.onclick=()=>{m=!m,m?(e.style.display="flex",setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},10)):(e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.style.display="none"},300))},n.onclick=()=>{m=!1,e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.style.display="none"},300)}}typeof window<"u"&&(window.PriceDropWidget={init:v,initFloating:C,parseProductFromPage:x});return P(F);})();
//# sourceMappingURL=price-drop-widget.min.js.map
