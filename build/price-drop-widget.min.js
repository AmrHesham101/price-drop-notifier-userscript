"use strict";(()=>{var v="pdn-widget-root",b="http://localhost:3000",y="";function C(){let o=document.createElement("div");return o.className=v,o.innerHTML=`
    <form class="pdn-form" novalidate>
      <label class="pdn-label">Email me if this product gets cheaper</label>
      <div class="pdn-row">
        <input class="pdn-input" type="email" name="email" placeholder="you@example.com" required />
        <button class="pdn-btn" type="submit">Notify me</button>
      </div>
      <div class="pdn-status" aria-live="polite"></div>
    </form>
  `,o}function w(){if(document.getElementById("pdn-widget-styles"))return;let o=document.createElement("link");o.rel="stylesheet",o.href=`${b}/build/price-drop-widget.min.css`,o.id="pdn-widget-styles",document.head.appendChild(o)}function f(){let o=location.href,d=document.querySelector("#productTitle"),n=document.querySelector(".x-item-title__mainTitle, #itemTitle, .it-ttl"),e=document.querySelector("h1, h2"),s=(d?.textContent||n?.textContent||e?.textContent||document.title).trim(),l=["#corePriceDisplay_desktop_feature_div .a-price .a-offscreen","#corePrice_desktop .a-price .a-offscreen",".priceToPay .a-offscreen","#priceblock_ourprice","#priceblock_dealprice",".a-price .a-offscreen",".x-price-primary .ux-textspans",".x-price-primary","#prcIsum",".display-price",".notranslate",".price"],t="";for(let a of l){let c=document.querySelector(a);if(c&&(c.textContent||"").trim()){t=(c.textContent||"").trim();break}}return t||(t="unknown"),{name:s,price:t,url:o}}async function g(o,d){let n=`${b}/subscribe-price-drop`,e={email:o,product:d};console.log("[PDN Widget] Using regular fetch");try{return(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}catch(s){throw s}}function E(o,d){let n=typeof o=="string"?document.querySelector(o):o;if(!n)return;w();let e=C();n.appendChild(e);let s=e.querySelector("form"),l=s.querySelector("input[name=email"),t=e.querySelector(".pdn-status"),a=d?.product??f();y&&(l.value=y),l.addEventListener("input",()=>{let c=l.value.trim();c&&c.includes("@")&&(y=c)}),s.addEventListener("submit",async c=>{c.preventDefault();let u=l.value.trim();if(!u){t.textContent="Please enter an email.",e.classList.add("pdn-error"),setTimeout(()=>e.classList.remove("pdn-error"),900);return}t.textContent="Submitting...",e.classList.add("pdn-submitting");try{let r=await g(u,a);r&&r.ok?(t.textContent="\u2713 Subscribed! We'll email you if price drops.",e.classList.add("pdn-success"),setTimeout(()=>{l.value="",t.textContent="",e.classList.remove("pdn-success")},3e3)):r&&r.error?(r.error==="already_subscribed"?t.textContent="Already subscribed to this product!":t.textContent="Error: "+r.error,e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),t.textContent=""},3e3)):(t.textContent="Unexpected response",e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),t.textContent=""},3e3))}catch{t.textContent="Network error",e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),t.textContent=""},3e3)}finally{e.classList.remove("pdn-submitting")}})}function S(o){let d=o?.product??f(),n=document.createElement("button");n.id="pdn-floating-button",n.innerHTML=`
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
      </svg>
    `,Object.assign(n.style,{position:"fixed",bottom:"24px",right:"24px",width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"#0E6F78",color:"white",border:"none",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:"999999",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"}),n.onmouseenter=()=>{n.style.transform="scale(1.1)",n.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.2)"},n.onmouseleave=()=>{n.style.transform="scale(1)",n.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"};let e=document.createElement("div");e.id="pdn-floating-widget",Object.assign(e.style,{position:"fixed",bottom:"92px",right:"24px",width:"380px",maxWidth:"calc(100vw - 48px)",backgroundColor:"#ffffff",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)",zIndex:"999998",display:"none",flexDirection:"column",overflow:"hidden",transition:"all 0.3s ease",opacity:"0",transform:"translateY(20px)"});let s=document.createElement("div");Object.assign(s.style,{padding:"16px",backgroundColor:"#0E6F78",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"});let l=document.createElement("div");l.textContent="\u{1F4B0} Price Drop Alert",l.style.fontWeight="600",l.style.fontSize="16px";let t=document.createElement("button");t.innerHTML="\xD7",Object.assign(t.style,{background:"none",border:"none",color:"white",fontSize:"28px",cursor:"pointer",lineHeight:"1",padding:"0",width:"24px",height:"24px"}),s.appendChild(l),s.appendChild(t);let a=document.createElement("div");Object.assign(a.style,{padding:"16px",fontFamily:"Arial, Helvetica, sans-serif"}),a.innerHTML=`
      <form id="pdn-floating-form" style="display: flex; flex-direction: column; gap: 12px;">
        <div style="font-size: 13px; color: #6B7280; margin-bottom: 4px;">
          <div style="margin-bottom: 8px;"><strong>Product:</strong> ${d.name.substring(0,80)}${d.name.length>80?"...":""}</div>
          <div style="margin-bottom: 8px;"><strong>Current Price:</strong> ${d.price}</div>
        </div>
        <label style="font-size: 14px; color: #111827; font-weight: 500;">Email me if price drops:</label>
        <div style="display: flex; gap: 8px;">
          <input 
            type="email" 
            id="pdn-email-floating" 
            placeholder="you@example.com" 
            required
            style="flex: 1; padding: 10px; border: 1px solid #D8DEE3; border-radius: 6px; font-size: 14px;"
          />
          <button 
            type="submit" 
            id="pdn-submit-floating"
            style="background: #0E6F78; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 14px; white-space: nowrap;"
          >Notify me</button>
        </div>
        <div id="pdn-status-floating" style="font-size: 13px; color: #6B7280; min-height: 18px;"></div>
      </form>
    `,e.appendChild(s),e.appendChild(a),document.body.appendChild(n),document.body.appendChild(e);let c=a.querySelector("#pdn-floating-form"),u=a.querySelector("#pdn-email-floating"),r=a.querySelector("#pdn-submit-floating"),i=a.querySelector("#pdn-status-floating");c.addEventListener("submit",async h=>{h.preventDefault();let x=u.value.trim();if(!x){i.textContent="Please enter an email.",i.style.color="#EF4444";return}i.textContent="Submitting...",i.style.color="#6B7280",r.disabled=!0,r.style.opacity="0.6";try{let p=await g(x,d);p&&p.ok?(i.textContent="\u2713 Subscribed! We'll email you if price drops.",i.style.color="#10B981",u.value="",setTimeout(()=>{i.textContent="",r.disabled=!1,r.style.opacity="1"},3e3)):p&&p.error?(p.error==="already_subscribed"?i.textContent="Already subscribed to this product!":i.textContent="Error: "+p.error,i.style.color="#EF4444",r.disabled=!1,r.style.opacity="1"):(i.textContent="Unexpected response",i.style.color="#EF4444",r.disabled=!1,r.style.opacity="1")}catch(p){i.textContent="Network error. Is the server running?",i.style.color="#EF4444",r.disabled=!1,r.style.opacity="1",console.error("Price Drop Notifier error:",p)}});let m=!1;n.onclick=()=>{m=!m,m?(e.style.display="flex",setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},10)):(e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.style.display="none"},300))},t.onclick=()=>{m=!1,e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.style.display="none"},300)}}typeof window<"u"&&(window.PriceDropWidget={init:E,initFloating:S,parseProductFromPage:f});})();
//# sourceMappingURL=price-drop-widget.min.js.map
