"use strict";var PriceDropWidget=(()=>{var d=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var v=(e,n)=>{for(var s in n)d(e,s,{get:n[s],enumerable:!0})},C=(e,n,s,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of b(n))!x.call(e,o)&&o!==s&&d(e,o,{get:()=>n[o],enumerable:!(t=y(n,o))||t.enumerable});return e};var L=e=>C(d({},"__esModule",{value:!0}),e);var E={};v(E,{init:()=>f});var h="pdn-widget-root",m="http://localhost:3000",p="";function S(){let e=document.createElement("div");return e.className=h,e.innerHTML=`
    <form class="pdn-form" novalidate>
      <label class="pdn-label">Email me if this product gets cheaper</label>
      <div class="pdn-row">
        <input class="pdn-input" type="email" name="email" placeholder="you@example.com" required />
        <button class="pdn-btn" type="submit">Notify me</button>
      </div>
      <div class="pdn-status" aria-live="polite"></div>
    </form>
  `,e}function g(){if(document.getElementById("pdn-widget-styles"))return;let e=document.createElement("link");e.rel="stylesheet",e.href=`${m}/build/price-drop-widget.min.css`,e.id="pdn-widget-styles",document.head.appendChild(e)}function T(){let e=location.href,n=document.querySelector("#productTitle"),s=document.querySelector(".x-item-title__mainTitle, #itemTitle, .it-ttl"),t=document.querySelector("h1, h2"),o=(n?.textContent||s?.textContent||t?.textContent||document.title).trim(),c=["#corePriceDisplay_desktop_feature_div .a-price .a-offscreen","#corePrice_desktop .a-price .a-offscreen",".priceToPay .a-offscreen","#priceblock_ourprice","#priceblock_dealprice",".a-price .a-offscreen",".x-price-primary .ux-textspans",".x-price-primary","#prcIsum",".display-price",".notranslate",".price"],r="";for(let l of c){let i=document.querySelector(l);if(i&&(i.textContent||"").trim()){r=(i.textContent||"").trim();break}}return r||(r="unknown"),{name:o,price:r,url:e}}async function w(e,n){let s=`${m}/subscribe-price-drop`,t={email:e,product:n};try{return(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}catch(o){throw o}}function f(e,n){let s=typeof e=="string"?document.querySelector(e):e;if(!s)return;g();let t=S();s.appendChild(t);let o=t.querySelector("form"),c=o.querySelector("input[name=email"),r=t.querySelector(".pdn-status"),l=n?.product??T();p&&(c.value=p),c.addEventListener("input",()=>{let i=c.value.trim();i&&i.includes("@")&&(p=i)}),o.addEventListener("submit",async i=>{i.preventDefault();let u=c.value.trim();if(!u){r.textContent="Please enter an email.",t.classList.add("pdn-error"),setTimeout(()=>t.classList.remove("pdn-error"),900);return}r.textContent="Submitting...",t.classList.add("pdn-submitting");try{let a=await w(u,l);a&&a.ok?(r.textContent="\u2713 Subscribed! We'll email you if price drops.",t.classList.add("pdn-success"),setTimeout(()=>{c.value="",r.textContent="",t.classList.remove("pdn-success")},3e3)):a&&a.error?(a.error==="already_subscribed"?r.textContent="Already subscribed to this product!":r.textContent="Error: "+a.error,t.classList.add("pdn-error"),setTimeout(()=>{t.classList.remove("pdn-error"),r.textContent=""},3e3)):(r.textContent="Unexpected response",t.classList.add("pdn-error"),setTimeout(()=>{t.classList.remove("pdn-error"),r.textContent=""},3e3))}catch{r.textContent="Network error",t.classList.add("pdn-error"),setTimeout(()=>{t.classList.remove("pdn-error"),r.textContent=""},3e3)}finally{t.classList.remove("pdn-submitting")}})}typeof window<"u"&&(window.PriceDropWidget={init:f});return L(E);})();
//# sourceMappingURL=price-drop-widget.min.js.map
