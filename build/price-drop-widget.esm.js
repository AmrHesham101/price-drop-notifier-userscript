var v="pdn-widget-root",b="http://localhost:3000",f="";function C(){let n=document.createElement("div");return n.className=v,n.innerHTML=`
    <form class="pdn-form" novalidate>
      <label class="pdn-label">Email me if this product gets cheaper</label>
      <div class="pdn-row">
        <input class="pdn-input" type="email" name="email" placeholder="you@example.com" required />
        <button class="pdn-btn" type="submit">Notify me</button>
      </div>
      <div class="pdn-status" aria-live="polite"></div>
    </form>
  `,n}function w(){if(document.getElementById("pdn-widget-styles"))return;let n=document.createElement("link");n.rel="stylesheet",n.href=`${b}/build/price-drop-widget.min.css`,n.id="pdn-widget-styles",document.head.appendChild(n)}function y(){let n=location.href,d=document.querySelector("#productTitle"),r=document.querySelector(".x-item-title__mainTitle, #itemTitle, .it-ttl"),e=document.querySelector("h1, h2"),l=(d?.textContent||r?.textContent||e?.textContent||document.title).trim(),a=["#corePriceDisplay_desktop_feature_div .a-price .a-offscreen","#corePrice_desktop .a-price .a-offscreen",".priceToPay .a-offscreen","#priceblock_ourprice","#priceblock_dealprice",".a-price .a-offscreen",".x-price-primary .ux-textspans",".x-price-primary","#prcIsum",".display-price",".notranslate",".price"],t="";for(let i of a){let c=document.querySelector(i);if(c&&(c.textContent||"").trim()){t=(c.textContent||"").trim();break}}return t||(t="unknown"),{name:l,price:t,url:n}}async function g(n,d){let r=`${b}/subscribe-price-drop`,e={email:n,product:d};console.log("[PDN Widget] Using regular fetch");try{return(await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}catch(l){throw l}}function E(n,d){let r=typeof n=="string"?document.querySelector(n):n;if(!r)return;w();let e=C();r.appendChild(e);let l=e.querySelector("form"),a=l.querySelector("input[name=email"),t=e.querySelector(".pdn-status"),i=d?.product??y();f&&(a.value=f),a.addEventListener("input",()=>{let c=a.value.trim();c&&c.includes("@")&&(f=c)}),l.addEventListener("submit",async c=>{c.preventDefault();let u=a.value.trim();if(!u){t.textContent="Please enter an email.",e.classList.add("pdn-error"),setTimeout(()=>e.classList.remove("pdn-error"),900);return}if(i.price.toLowerCase()==="unknown"||!/\d/.test(i.price)){t.textContent="Cannot subscribe - price unavailable.",e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),t.textContent=""},3e3);return}t.textContent="Submitting...",e.classList.add("pdn-submitting");try{let o=await g(u,i);if(o&&o.ok)t.textContent="\u2713 Subscribed! We'll email you if price drops.",e.classList.add("pdn-success"),setTimeout(()=>{a.value="",t.textContent="",e.classList.remove("pdn-success")},3e3);else if(o&&o.error){if(o.error==="already_subscribed")t.textContent="Already subscribed to this product!";else if(o.errors&&o.errors.length>0){let s=o.errors[0].msg||o.errors[0].message||"Validation failed";t.textContent=s}else t.textContent="Error: "+o.error;e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),t.textContent=""},3e3)}else t.textContent="Unexpected response",e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),t.textContent=""},3e3)}catch{t.textContent="Network error",e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),t.textContent=""},3e3)}finally{e.classList.remove("pdn-submitting")}})}function L(n){let d=n?.product??y(),r=document.createElement("button");r.id="pdn-floating-button",r.innerHTML=`
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
      </svg>
    `,Object.assign(r.style,{position:"fixed",bottom:"24px",right:"24px",width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"#0E6F78",color:"white",border:"none",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",zIndex:"999999",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"}),r.onmouseenter=()=>{r.style.transform="scale(1.1)",r.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.2)"},r.onmouseleave=()=>{r.style.transform="scale(1)",r.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"};let e=document.createElement("div");e.id="pdn-floating-widget",Object.assign(e.style,{position:"fixed",bottom:"92px",right:"24px",width:"380px",maxWidth:"calc(100vw - 48px)",backgroundColor:"#ffffff",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)",zIndex:"999998",display:"none",flexDirection:"column",overflow:"hidden",transition:"all 0.3s ease",opacity:"0",transform:"translateY(20px)"});let l=document.createElement("div");Object.assign(l.style,{padding:"16px",backgroundColor:"#0E6F78",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"});let a=document.createElement("div");a.textContent="\u{1F4B0} Price Drop Alert",a.style.fontWeight="600",a.style.fontSize="16px";let t=document.createElement("button");t.innerHTML="\xD7",Object.assign(t.style,{background:"none",border:"none",color:"white",fontSize:"28px",cursor:"pointer",lineHeight:"1",padding:"0",width:"24px",height:"24px"}),l.appendChild(a),l.appendChild(t);let i=document.createElement("div");Object.assign(i.style,{padding:"16px",fontFamily:"Arial, Helvetica, sans-serif"}),i.innerHTML=`
      <form id="pdn-floating-form" style="display: flex; flex-direction: column; gap: 12px;">
        <div style="font-size: 13px; color: #6B7280; margin-bottom: 4px;">
          <div style="margin-bottom: 8px;"><strong>Product:</strong> ${d.name.substring(0,80)}${d.name.length>80?"...":""}</div>
          <div style="margin-bottom: 8px;"><strong>Current Price:</strong> ${d.price}</div>
        </div>
        <label style="font-size: 14px; color: #111827; font-weight: 500;">Email me if price drops:</label>
        <div style="display: flex; gap: 8px;">
          <input 
            type="email" 
            id="pdn-email-floating" 
            placeholder="you@example.com" 
            required
            style="flex: 1; padding: 10px; border: 1px solid #D8DEE3; border-radius: 6px; font-size: 14px;"
          />
          <button 
            type="submit" 
            id="pdn-submit-floating"
            style="background: #0E6F78; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 14px; white-space: nowrap;"
          >Notify me</button>
        </div>
        <div id="pdn-status-floating" style="font-size: 13px; color: #6B7280; min-height: 18px;"></div>
      </form>
    `,e.appendChild(l),e.appendChild(i),document.body.appendChild(r),document.body.appendChild(e);let c=i.querySelector("#pdn-floating-form"),u=i.querySelector("#pdn-email-floating"),o=i.querySelector("#pdn-submit-floating"),s=i.querySelector("#pdn-status-floating");c.addEventListener("submit",async h=>{h.preventDefault();let x=u.value.trim();if(!x){s.textContent="Please enter an email.",s.style.color="#EF4444";return}s.textContent="Submitting...",s.style.color="#6B7280",o.disabled=!0,o.style.opacity="0.6";try{let p=await g(x,d);p&&p.ok?(s.textContent="\u2713 Subscribed! We'll email you if price drops.",s.style.color="#10B981",u.value="",setTimeout(()=>{s.textContent="",o.disabled=!1,o.style.opacity="1"},3e3)):p&&p.error?(p.error==="already_subscribed"?s.textContent="Already subscribed to this product!":s.textContent="Error: "+p.error,s.style.color="#EF4444",o.disabled=!1,o.style.opacity="1"):(s.textContent="Unexpected response",s.style.color="#EF4444",o.disabled=!1,o.style.opacity="1")}catch(p){s.textContent="Network error. Is the server running?",s.style.color="#EF4444",o.disabled=!1,o.style.opacity="1",console.error("Price Drop Notifier error:",p)}});let m=!1;r.onclick=()=>{m=!m,m?(e.style.display="flex",setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},10)):(e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.style.display="none"},300))},t.onclick=()=>{m=!1,e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.style.display="none"},300)}}typeof window<"u"&&(window.PriceDropWidget={init:E,initFloating:L,parseProductFromPage:y});export{E as init,L as initFloating};
//# sourceMappingURL=price-drop-widget.esm.js.map
