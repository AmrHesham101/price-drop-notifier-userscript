var m="pdn-widget-root",u="http://localhost:3000",d="";function f(){let t=document.createElement("div");return t.className=m,t.innerHTML=`
    <form class="pdn-form" novalidate>
      <label class="pdn-label">Email me if this product gets cheaper</label>
      <div class="pdn-row">
        <input class="pdn-input" type="email" name="email" placeholder="you@example.com" required />
        <button class="pdn-btn" type="submit">Notify me</button>
      </div>
      <div class="pdn-status" aria-live="polite"></div>
    </form>
  `,t}function y(){if(document.getElementById("pdn-widget-styles"))return;let t=document.createElement("link");t.rel="stylesheet",t.href=`${u}/build/price-drop-widget.min.css`,t.id="pdn-widget-styles",document.head.appendChild(t)}function b(){let t=location.href,a=document.querySelector("#productTitle"),c=document.querySelector(".x-item-title__mainTitle, #itemTitle, .it-ttl"),e=document.querySelector("h1, h2"),o=(a?.textContent||c?.textContent||e?.textContent||document.title).trim(),s=["#corePriceDisplay_desktop_feature_div .a-price .a-offscreen","#corePrice_desktop .a-price .a-offscreen",".priceToPay .a-offscreen","#priceblock_ourprice","#priceblock_dealprice",".a-price .a-offscreen",".x-price-primary .ux-textspans",".x-price-primary","#prcIsum",".display-price",".notranslate",".price"],r="";for(let l of s){let n=document.querySelector(l);if(n&&(n.textContent||"").trim()){r=(n.textContent||"").trim();break}}return r||(r="unknown"),{name:o,price:r,url:t}}async function x(t,a){let c=`${u}/subscribe-price-drop`,e={email:t,product:a};try{return(await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}catch(o){throw o}}function v(t,a){let c=typeof t=="string"?document.querySelector(t):t;if(!c)return;y();let e=f();c.appendChild(e);let o=e.querySelector("form"),s=o.querySelector("input[name=email"),r=e.querySelector(".pdn-status"),l=a?.product??b();d&&(s.value=d),s.addEventListener("input",()=>{let n=s.value.trim();n&&n.includes("@")&&(d=n)}),o.addEventListener("submit",async n=>{n.preventDefault();let p=s.value.trim();if(!p){r.textContent="Please enter an email.",e.classList.add("pdn-error"),setTimeout(()=>e.classList.remove("pdn-error"),900);return}r.textContent="Submitting...",e.classList.add("pdn-submitting");try{let i=await x(p,l);i&&i.ok?(r.textContent="\u2713 Subscribed! We'll email you if price drops.",e.classList.add("pdn-success"),setTimeout(()=>{s.value="",r.textContent="",e.classList.remove("pdn-success")},3e3)):i&&i.error?(i.error==="already_subscribed"?r.textContent="Already subscribed to this product!":r.textContent="Error: "+i.error,e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),r.textContent=""},3e3)):(r.textContent="Unexpected response",e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),r.textContent=""},3e3))}catch{r.textContent="Network error",e.classList.add("pdn-error"),setTimeout(()=>{e.classList.remove("pdn-error"),r.textContent=""},3e3)}finally{e.classList.remove("pdn-submitting")}})}typeof window<"u"&&(window.PriceDropWidget={init:v});export{v as init};
//# sourceMappingURL=price-drop-widget.esm.js.map
